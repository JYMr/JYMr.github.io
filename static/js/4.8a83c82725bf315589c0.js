webpackJsonp([4],{"3Zq0":function(t,e,i){"use strict";var o=i("AA3o"),r=i.n(o),a=i("xSur"),l=i.n(a),s=i("LJJC"),n=i("++MA"),c=new(function(){function t(){r()(this,t)}return l()(t,[{key:"getProductData",value:function(t){return Object(s.c)("/commodity/supplier/commodity/commoditys",t).then(function(t){return t})}},{key:"getProductDetail",value:function(t){return Object(s.b)("/commodity/supplier/commodity/commodity/"+t).then(function(t){if(4095294432e3==t.soldOutTime&&(t.soldOutTime=null),2===t.type&&t.drugs.length>0){var e=t.drugs.map(function(t){return t.approvalNumber});t.drugs[0].approvalNumber=e.toString()}return 0==t.grouponPrice&&(t.grouponPrice=null),null===t.drugTestUrl&&(t.drugTestUrl={url:""}),0==t.seq&&(t.seq=null),t})}},{key:"commoditysByOpen",value:function(t){return Object(s.d)("/commodity/supplier/commodity/commoditysByOpen",t).then(function(t){return t})}},{key:"commoditysByPause",value:function(t){return Object(s.d)("/commodity/supplier/commodity/commoditysByPause",t).then(function(t){return t})}},{key:"addcommodity",value:function(t){return null==t.soldOutTime&&(t.soldOutTime=4095294432e3),Object(s.c)("/commodity/supplier/commodity/commodity",t).then(function(t){return t})}},{key:"editcommodity",value:function(t){return null==t.soldOutTime&&(t.soldOutTime=4095294432e3),Object(s.d)("/commodity/supplier/commodity/commodity",t).then(function(t){return t})}},{key:"applyByCommodity",value:function(t){return null==t.soldOutTime&&(t.soldOutTime=4095294432e3),Object(s.c)("/commodity/supplier/apply/applyByCommodity",t).then(function(t){return t})}},{key:"commodityByState",value:function(t){return Object(s.d)("/commodity/supplier/commodity/commodityByState",t).then(function(t){return t})}},{key:"uploadmanual",value:function(t,e){return Object(s.c)("/commodity/supplier/drug/leaflet/"+t,e).then(function(t){return t})}},{key:"importExecl",value:function(t){return Object(s.e)("/commodity/import/exportCommodity",{data:t,headers:{token:n.default.prototype.$token},responseType:"arraybuffer",method:"POST"},!1).then(function(t){return t})}}]),t}());e.a=c},"66iS":function(t,e){},"D/eO":function(t,e,i){"use strict";var o=i("4YfN"),r=i.n(o),a=i("aA9S"),l=i.n(a),s=i("5VHC"),n=i("KM1H"),c=i("AA3o"),u=i.n(c),m=i("xSur"),d=i.n(m),p=i("LJJC"),f=new(function(){function t(){u()(this,t)}return d()(t,[{key:"getProductList",value:function(t){return Object(p.c)("/commodity/supplier/commodity/commoditys",t).then(function(t){return t})}}]),t}()),v={props:{type:{type:String,default:"drugs"},visible:{type:Boolean,required:!0,value:!1},ignoreList:{type:Array,value:[]}},data:function(){return{dialogTableVisible:!1,loading:!1,searchform:{},checkList:[],productlist:{list:[]},pageVo:{pageNo:1,size:24},clickTime:null}},methods:{getProductList:function(){var t=this,e=l()(this.searchform,{pageVo:this.pageVo});this.loading=!0,"drugs"===this.type?(e=r()({},e,{ids:this.ignoreList,applyState:1}),n.a.getapplysList(e).then(function(e){t.loading=!1,t.productlist=e})):"product"===this.type&&(e=r()({},e,{ids:this.ignoreList,state:1}),f.getProductList(e).then(function(e){t.loading=!1,t.productlist=e}))},paginationChange:function(t){this.pageVo.pageNo=parseInt(t),this.getProductList()},paginationSizeChange:function(t){this.pageVo={pageNo:1,size:parseInt(t)},this.getProductList()},chooseProduct:function(t){var e=this;this.clickTime&&clearTimeout(this.clickTime),this.clickTime=setTimeout(function(){e.dialogTableVisible=!1,e.$emit("chooseProduct",t)},200)},handleopen:function(){var t=this;setTimeout(function(){t.getProductList(),t.$emit("open")},0)}},watch:{visible:function(t,e){this.dialogTableVisible=t},dialogTableVisible:function(t,e){t||this.$emit("update:visible",t)}},components:{SelectInput:s.a}},g={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:"drugs"===t.type?"选择药品":"选择商品",visible:t.dialogTableVisible,width:"1266px"},on:{"update:visible":function(e){t.dialogTableVisible=e},open:t.handleopen}},[o("el-form",{ref:"form",attrs:{model:t.searchform,"label-width":"80px"}},[o("el-row",[o("el-col",{attrs:{lg:6}},["drugs"===t.type?o("el-form-item",{attrs:{"label-width":"0"}},[o("SelectInput",{attrs:{selectList:[{label:"药品编码",key:"commodityEncoding"},{label:"商品名称",key:"name"},{label:"批准文号",key:"approvalNumber"},{label:"厂家",key:"manufacturers"}]},model:{value:t.searchform,callback:function(e){t.searchform=e},expression:"searchform"}})],1):t._e(),t._v(" "),"product"===t.type?o("el-form-item",{attrs:{"label-width":"0"}},[o("SelectInput",{attrs:{selectList:[{label:"商品编码",key:"numberEncoding"},{label:"商品名称",key:"name"},{label:"批准文号",key:"approvalNumber"},{label:"厂家",key:"manufacturers"}]},model:{value:t.searchform,callback:function(e){t.searchform=e},expression:"searchform"}})],1):t._e()],1),t._v(" "),"product"===t.type?o("el-col",{attrs:{lg:10}},[o("el-form-item",{attrs:{label:"上架时间"}},[o("el-col",{attrs:{span:11}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"timestamp"},model:{value:t.searchform.putawayStartTime,callback:function(e){t.$set(t.searchform,"putawayStartTime",e)},expression:"searchform.putawayStartTime"}})],1),t._v(" "),o("el-col",{staticClass:"line",attrs:{span:1}},[t._v("-")]),t._v(" "),o("el-col",{attrs:{span:11}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"timestamp","default-time":"23:59:59"},model:{value:t.searchform.putawayEndTime,callback:function(e){t.$set(t.searchform,"putawayEndTime",e)},expression:"searchform.putawayEndTime"}})],1)],1)],1):t._e(),t._v(" "),"drugs"===t.type?o("el-col",{attrs:{lg:10}},[o("el-form-item",{attrs:{label:"上架时间"}},[o("el-col",{attrs:{span:11}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"timestamp"},model:{value:t.searchform.applyStartTime,callback:function(e){t.$set(t.searchform,"applyStartTime",e)},expression:"searchform.applyStartTime"}})],1),t._v(" "),o("el-col",{staticClass:"line",attrs:{span:1}},[t._v("-")]),t._v(" "),o("el-col",{attrs:{span:11}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"timestamp","default-time":"23:59:59"},model:{value:t.searchform.applyEndTime,callback:function(e){t.$set(t.searchform,"applyEndTime",e)},expression:"searchform.applyEndTime"}})],1)],1)],1):t._e(),t._v(" "),o("el-col",{attrs:{md:6}},[o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:t.getProductList}},[t._v("搜索")])],1)],1)],1)],1),t._v(" "),t.productlist.list.length>0&&"drugs"===t.type?o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"product-list"},t._l(t.productlist.list,function(e,r){return o("div",{key:"product_item_"+r,staticClass:"product-item",on:{click:function(i){t.chooseProduct(e)}}},[e.commoditysUrl.length>0?o("img",{attrs:{src:e.commoditysUrl[0].url,alt:""}}):o("img",{attrs:{src:i("OQeE")}}),t._v(" "),o("div",{staticClass:"product-data"},[o("span",[t._v("ID: "+t._s(e.id))]),t._v(" "),o("span",[t._v(t._s(e.name))]),t._v(" "),o("span",[t._v(t._s(e.specification))]),t._v(" "),o("span",[t._v(t._s(e.manufacturers))]),t._v(" "),o("span",[t._v(t._s(e.approvalNumber))])])])})):t._e(),t._v(" "),t.productlist.list.length>0&&"product"===t.type?o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"product-list"},t._l(t.productlist.list,function(e,i){return o("div",{key:"product_item_"+i,staticClass:"product-item",on:{click:function(i){t.chooseProduct(e)}}},[e.listImageUrl.length>0?o("img",{attrs:{src:e.listImageUrl[0].url,alt:""}}):t._e(),t._v(" "),o("div",{staticClass:"product-data"},[o("span",[t._v("ID: "+t._s(e.id))]),t._v(" "),o("span",[t._v(t._s(e.name))]),t._v(" "),o("span",[t._v(t._s(e.specification))])])])})):t._e(),t._v(" "),t.productlist.list.length<=0?o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"product-list empty"},[t._v("暂无数据")]):t._e(),t._v(" "),t.productlist.list.length>0?o("div",{staticClass:"table-pagination"},[o("el-pagination",{attrs:{layout:"total, prev, pager, next",total:Number(t.productlist.total),"current-page":t.productlist.pageNum,"prev-text":"上一页","next-text":"下一页"},on:{"current-change":t.paginationChange,"size-change":t.paginationSizeChange}})],1):t._e()],1)},staticRenderFns:[]};var h=i("vSla")(v,g,!1,function(t){i("66iS")},null,null);e.a=h.exports},OQeE:function(t,e){t.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAoHBwkHBgoJCAkLCwoMDxkQDw4ODx4WFxIZJCAmJSMgIyIoLTkwKCo2KyIjMkQyNjs9QEBAJjBGS0U+Sjk/QD3/2wBDAQsLCw8NDx0QEB09KSMpPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT3/wgARCACWAJYDAREAAhEBAxEB/8QAGgABAAMBAQEAAAAAAAAAAAAAAAMEBQIBB//EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAPpQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAtEZmkZaLx4Z5AAAAATmqAVCE0D0EZjgAAAFs0QCoQExcBwYwAAABbNEFcywC2aBnFUAAAAtmiCkUAAXiiAAAAC2aIIjKOT00C2UigAAAAWjSAK5ETkwOTFAAAAJjVPQUisaZ2CAygAAAAWi0RFI5JS4eFI4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB/8QALxAAAgEBBQUHBQEBAAAAAAAAAQIDBAAQERJREyAwMkEFISIxM3LBYGFxgbEUFf/aAAgBAQABPwD6jFqeiVRml7zpYKAO4AWkpo5QcVAOotNCYZCrfo3U1IZfE+IX+2WCNOVBZ6eJ/NBappjAdVPkeFRpnqB9hjuVyYwZuqm1LSZ/G/L0GthfMm0iZdeF2f67e353KmpjUFCM50t/0JOirhaGuVzlcZfv0vkfJGzHoOF2f67e35vq5djCSPM9w3KWqyeBz4eh0uqqra+BOXXXhdn+u3t+b+0eRPzuC2wn/wAmXMfb9uH2f67e35vni20RSzoUcqwwIuAxOAFqWlEYzvz/AMuracFTKo7x58Kg9dvbuVQTZFnUNhZKOCQZldiDaKnjh5V79byMVI14VNJspgT+DuV8mCCPqTibU9Q0D6r1Fo3WRcynEX1MoihbU9w4cFY0QysMVsK2EjmI/VpK9QDswSdTZmLsSxxJuhneFvCcR1Fkr4zzAg2evQciljaSVpnzN9S//8QAFBEBAAAAAAAAAAAAAAAAAAAAgP/aAAgBAgEBPwA0/wD/xAAUEQEAAAAAAAAAAAAAAAAAAACA/9oACAEDAQE/ADT/AP/Z"},R1Tc:function(t,e){},cweG:function(t,e){},cy5p:function(t,e){},gIVW:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("HzJ8"),r=i.n(o),a=i("4YfN"),l=i.n(a),s=i("aA9S"),n=i.n(s),c=i("a3Yh"),u=i.n(c),m=i("D/eO"),d=i("xCLT"),p=i("w3CS"),f={props:{form:{type:Object}},data:function(){return{productOneform:{},visible:!1,categorydata:[],props:{label:"name",value:"id",children:"children"},chooseProductObj:{},ignoreList:[],categoryArr:[],isInit:!1,validator:p.a}},mounted:function(){this.getCategory()},methods:{initData:function(){var t=this;if(!this.isInit){if(1===this.form.drugs.length&&void 0===this.chooseProductObj.id&&(this.chooseProductObj=this.form.drugs[0]),null!==this.form.relation&&void 0!==this.form.relation){var e=this.form.relation.split("/");this.categoryArr=e,this.getCategory(function(){t.getCategoryChild([e[0]],function(){t.getCategoryChild([e[0],e[1]])})})}this.isInit=!0}},AddProduct:function(){this.ignoreList=void 0!==this.chooseProductObj.id?[this.chooseProductObj.id]:[],this.visible=!0},chooseProduct:function(t){if(void 0!==t.id){this.chooseProductObj=t;var e=this.form;0===e.drugs.length&&e.drugs.push(new Object),e.drugs[0].id=t.id,e.commoditySpecificationVo.specification=t.specification,e.commoditySpecificationVo.unit=t.unit,e.commoditySpecificationVo.packNumber=t.packNumber,e.commoditySpecificationVo.entiretyNumber=t.entiretyNumber,e.commoditySpecificationVo.approvalNumber=t.approvalNumber,e.commoditySpecificationVo.manufacturers=t.manufacturers,0===e.listImageUrl.length&&t.commoditysUrl.length>0&&(e.listImageUrl=[].concat(t.commoditysUrl)),this.$emit("update:form",e)}},getCategory:function(t){var e=this;d.a.getChildCategory("0").then(function(i){e.categorydata=i,t&&t()})},getCategoryChild:function(t,e){var i=1===t.length?t[0]:t[1],o=this.categorydata,a=!0;if(1!==t.length){var l=!0,s=!1,n=void 0;try{for(var c,u=r()(o);!(l=(c=u.next()).done);l=!0){var m=c.value;if(m.id===t[0]){o=m.children;break}}}catch(t){s=!0,n=t}finally{try{!l&&u.return&&u.return()}finally{if(s)throw n}}a=!1}d.a.getChildCategory(i,a).then(function(t){var a=!0,l=!1,s=void 0;try{for(var n,c=r()(o);!(a=(n=c.next()).done);a=!0){var u=n.value;u.id===i&&(u.children=t)}}catch(t){l=!0,s=t}finally{try{!a&&c.return&&c.return()}finally{if(l)throw s}}e&&e()})},handleItemChange:function(t){this.getCategoryChild(t)},handleChange:function(t){if(3===t.length){var e=this.form;e.categoryId=t[2],this.$emit("updata:form",e)}},checkProduct:function(t,e,i){0===e.length?i(new Error("请选择商品")):i()}},watch:{form:{deep:!0,handler:function(t,e){this.initData()}}},components:{ProductSelecter:m.a}},v={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-form-item",{attrs:{label:"选择商品分类",prop:"categoryId",rules:{required:!0,message:"请选择商品分类",trigger:"blur"}}},[o("el-col",{attrs:{lg:6}},[o("el-cascader",{attrs:{value:t.categoryArr,options:t.categorydata,props:t.props},on:{"active-item-change":t.handleItemChange,change:t.handleChange}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"选择药品",prop:"drugs",rules:{validator:t.checkProduct,trigger:"blur"}}},[t.chooseProductObj.id?o("el-col",{attrs:{lg:18}},[o("div",{staticClass:"choose-product"},[t.chooseProductObj.commoditysUrl&&t.chooseProductObj.commoditysUrl.length>0?o("img",{attrs:{src:t.chooseProductObj.commoditysUrl[0].url,alt:""}}):o("img",{attrs:{src:i("OQeE")}}),t._v(" "),""==t.form.id?o("el-button",{attrs:{type:"text"},on:{click:t.AddProduct}},[t._v("重新选择商品")]):t._e(),t._v(" "),o("div",{staticClass:"choose-product-data"},[o("p",[t._v("商品分类："+t._s(t.chooseProductObj.category))]),t._v(" "),o("p",[t._v("药品编号："+t._s(t.chooseProductObj.commodityEncoding))]),t._v(" "),o("p",[t._v("商品名称："+t._s(t.chooseProductObj.name))]),t._v(" "),o("p",[t._v("建议零售价："+t._s(t._f("price")(t.chooseProductObj.retailPrice)))]),t._v(" "),o("p",[t._v("商品规格："+t._s(t.chooseProductObj.specification))]),t._v(" "),o("p",[t._v("中包装数："+t._s(t.chooseProductObj.packNumber))]),t._v(" "),o("p",[t._v("整件数量："+t._s(t.chooseProductObj.entiretyNumber))])])],1)]):t._e(),t._v(" "),t.chooseProductObj.id?t._e():o("el-col",{attrs:{lg:6}},[o("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:t.AddProduct}},[t._v("选择商品")])],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"规格/包装",prop:"commoditySpecificationVo.specification",rules:{required:!0,message:"请输入规格/包装",trigger:"blur"}}},[o("el-col",{attrs:{lg:6}},[o("el-input",{attrs:{disabled:""},model:{value:t.form.commoditySpecificationVo.specification,callback:function(e){t.$set(t.form.commoditySpecificationVo,"specification",e)},expression:"form.commoditySpecificationVo.specification"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"单位",prop:"commoditySpecificationVo.unit",rules:{required:!0,message:"请输入单位",trigger:"blur"}}},[o("el-col",{attrs:{lg:6}},[o("el-input",{attrs:{disabled:""},model:{value:t.form.commoditySpecificationVo.unit,callback:function(e){t.$set(t.form.commoditySpecificationVo,"unit",e)},expression:"form.commoditySpecificationVo.unit"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"商品编码"}},[o("el-col",{attrs:{lg:6}},[o("el-input",{model:{value:t.form.commodityEncoding,callback:function(e){t.$set(t.form,"commodityEncoding",e)},expression:"form.commodityEncoding"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"采购起订量",prop:"minNumber",rules:[{required:!0,message:"请输入采购起订量",trigger:"blur"},{validator:t.validator.positiveIntegers,trigger:"blur"}]}},[o("el-col",{attrs:{lg:6}},[o("el-input",{model:{value:t.form.minNumber,callback:function(e){t.$set(t.form,"minNumber",e)},expression:"form.minNumber"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"购买倍数",prop:"shopMul",rules:[{required:!0,message:"请输入购买倍数",trigger:"blur"},{validator:t.validator.positiveIntegers,trigger:"blur"}]}},[o("el-col",{attrs:{lg:6}},[o("el-input",{model:{value:t.form.shopMul,callback:function(e){t.$set(t.form,"shopMul",e)},expression:"form.shopMul"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"商城显示商品名称",rules:{required:!0,message:"请输入商城显示商品名称",trigger:"blur"}}},[o("el-col",{attrs:{lg:6}},[o("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"商品列表排序",prop:"seq",rules:{validator:t.validator.positiveIntegers,trigger:"blur"}}},[o("el-col",{attrs:{lg:6}},[o("el-input",{model:{value:t.form.seq,callback:function(e){t.$set(t.form,"seq",e)},expression:"form.seq"}})],1)],1),t._v(" "),o("ProductSelecter",{attrs:{visible:t.visible,ignoreList:t.ignoreList},on:{"update:visible":function(e){t.visible=e},chooseProduct:t.chooseProduct}})],1)},staticRenderFns:[]};var g=i("vSla")(f,v,!1,function(t){i("R1Tc")},null,null).exports,h={props:{form:Object},data:function(){return{init:!1,visible:!1,ChooseList:[],ignoreList:[],validatePackage:p.a.validatePackage,validator:p.a}},mounted:function(){this.initData()},methods:{initData:function(){if(this.form.drugs.length>0&&!this.init){var t=this.form.drugs,e=[],i=!0,o=!1,a=void 0;try{for(var l,s=r()(t);!(i=(l=s.next()).done);i=!0){var n=l.value;n.id&&e.push(n)}}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}this.ChooseList=e}},AddProduct:function(){var t=[],e=!0,i=!1,o=void 0;try{for(var a,l=r()(this.ChooseList);!(e=(a=l.next()).done);e=!0){var s=a.value;t.push(s.id)}}catch(t){i=!0,o=t}finally{try{!e&&l.return&&l.return()}finally{if(i)throw o}}this.ignoreList=t,this.visible=!0},handlePackageChange:function(){var t=this.form,e=0,i=!0,o=!1,a=void 0;try{for(var l,s=r()(this.ChooseList);!(i=(l=s.next()).done);i=!0){var n=l.value;e+=parseFloat(n.comboNum)*parseFloat(n.comboPrice).toFixed(2)}}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}t.originalPrice=e.toFixed(2),t=this.handleDrug(t),t=this.handleData(t),t=this.handleapprovalNumber(t),this.$emit("update:form",t)},chooseProduct:function(t){this.init=!0,this.ChooseList.push(n()(t,{comboPrice:t.retailPrice,comboNum:1})),this.handlePackageChange()},delProduct:function(t){this.ChooseList.splice(t,1),this.handlePackageChange()},handleapprovalNumber:function(t){var e=[],i=!0,o=!1,a=void 0;try{for(var l,s=r()(this.ChooseList);!(i=(l=s.next()).done);i=!0){var n=l.value;e.push(n.approvalNumber)}}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}return t.drugs[0].approvalNumber=e.toString(),t},handleData:function(t){var e=this.ChooseList[0];return t.commoditySpecificationVo.specification=e.specification,t.commoditySpecificationVo.unit=e.unit,t.drugs[0].packNumber=e.packNumber,t.drugs[0].entiretyNumber=e.entiretyNumber,t},handleDrug:function(t){var e=[],i=!0,o=!1,a=void 0;try{for(var l,s=r()(this.ChooseList);!(i=(l=s.next()).done);i=!0){var n=l.value,c=n.id,u=n.comboNum,m=n.comboPrice;e.push({id:c,comboNum:u,comboPrice:m})}}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}return t.drugs=e,t}},watch:{form:{deep:!0,handler:function(t,e){this.initData(),this.init=!0}}},components:{ProductSelecter:m.a}},y={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-form-item",{attrs:{label:"选择套餐药品"}},[i("el-col",{attrs:{lg:18}},[t.ChooseList.length>0?i("div",{staticClass:"ChooseList"},t._l(t.ChooseList,function(e,o){return i("div",{key:"ChooseList_"+o,staticClass:"ChooseList-item"},[i("h4",[t._v("药品"+t._s(o+1)),i("i",[t._v(t._s(e.commodityEncoding))]),i("i",[t._v(t._s(e.name))]),i("i",[t._v(t._s(e.specification))])]),t._v(" "),i("div",{staticClass:"item-data"},[i("el-row",[i("el-col",{attrs:{lg:4}},[t._v("\n                                原价: ￥"+t._s(t._f("price")(e.retailPrice))+"\n                            ")]),t._v(" "),i("el-col",{attrs:{lg:7,offset:1}},[i("el-form-item",{attrs:{label:"套餐包含的单品单价",prop:"drugs["+o+"]",rules:[{validator:t.validatePackage.price,trigger:"blur"}]}},[i("el-input",{attrs:{size:"mini"},on:{change:t.handlePackageChange},model:{value:e.comboPrice,callback:function(i){t.$set(e,"comboPrice",i)},expression:"item.comboPrice"}})],1)],1),t._v(" "),i("el-col",{attrs:{lg:7,offset:1}},[i("el-form-item",{attrs:{label:"套餐包含的单品数量",prop:"drugs["+o+"]",rules:[{validator:t.validatePackage.number,trigger:"blur"}]}},[i("el-input",{attrs:{size:"mini"},on:{change:t.handlePackageChange},model:{value:e.comboNum,callback:function(i){t.$set(e,"comboNum",i)},expression:"item.comboNum"}})],1)],1),t._v(" "),i("el-col",{attrs:{lg:3,offset:1}},[i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){t.delProduct(o)}}},[t._v("删除")])],1)],1)],1)])})):t._e(),t._v(" "),i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:t.AddProduct}},[t._v("选择商品")])],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"采购起订量",prop:"minNumber",rules:[{required:!0,message:"请输入采购起订量",trigger:"blur"},{validator:t.validator.positiveIntegers,trigger:"blur"}]}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.minNumber,callback:function(e){t.$set(t.form,"minNumber",e)},expression:"form.minNumber"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"购买倍数",prop:"shopMul",rules:[{required:!0,message:"请输入购买倍数",trigger:"blur"},{validator:t.validator.positiveIntegers,trigger:"blur"}]}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.shopMul,callback:function(e){t.$set(t.form,"shopMul",e)},expression:"form.shopMul"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"商城显示商品名称",rules:{required:!0,message:"请输入商城显示商品名称",trigger:"blur"}}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"商品列表排序"}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.seq,callback:function(e){t.$set(t.form,"seq",t._n(e))},expression:"form.seq"}})],1)],1),t._v(" "),i("ProductSelecter",{attrs:{visible:t.visible,ignoreList:t.ignoreList},on:{"update:visible":function(e){t.visible=e},chooseProduct:t.chooseProduct}})],1)},staticRenderFns:[]};var A=i("vSla")(h,y,!1,function(t){i("cweG")},null,null).exports,b=i("1MSS"),_=i("3Zq0"),P=i("hY9u"),k=i("Leza"),C={data:function(){var t;return{id:this.$route.query.id,editMode:!1,mode:1,open:this.$route.query.open,form:(t={id:"",categoryId:"",minNumber:"",individualPurchasePrice:"",putawayTime:"",originalPrice:"",grouponPrice:"",drugs:[{}],businessArea:"0",supply:"",soldOutTime:""},u()(t,"minNumber",""),u()(t,"shopMul",""),u()(t,"seq",""),u()(t,"repertory",""),u()(t,"commoditySpecificationVo",{commodityId:"",specification:"",unit:"",packNumber:"",entiretyNumber:"",approvalNumber:"",manufacturers:""}),u()(t,"drugTestUrl",{}),u()(t,"listImageUrl",[]),u()(t,"commoditysInfoUrl",[]),t),businessAreaList:[],UploadUrl:k.b,Headers:k.a,validator:p.a}},mounted:function(){void 0!==this.id&&(this.editMode=!0,this.getProductDetail(this.id))},methods:{getProductDetail:function(t){var e=this;_.a.getProductDetail(t).then(function(t){e.form=n()(e.form,t),e.mode=t.type,e.getBusinessArea()})},getBusinessArea:function(){var t=this;P.a.getSupplierTradeBySupplierToken().then(function(e){t.businessAreaList=e})},submit:function(){this.editMode?this.editcommodity():this.addcommodity()},commoditysByOpen:function(){var t=this;this.$refs.form.validate().then(function(e){if(e){var i={id:[t.id],state:1};_.a.commodityByState(i).then(function(e){t.$message.success("操作成功"),t.$router.back()})}}).catch(function(e){e||t.$message.error("商品数据还不完善，请完善资料之后再上架商品!")})},applyByCommodity:function(){var t=this;this.$refs.form.validate().then(function(e){if(e){var i=t.form,o=i.commoditySpecificationVo,r=o.unit,a=o.specification,s=o.approvalNumber,n=o.activityExplain,c=o.id,u=o.validDate,m=o.productDate,d=new Object;1===t.mode?d={unit:r,specification:a,approvalNumber:s,activityExplain:n,id:c,validDate:u,productDate:m}:2===t.mode&&(d={unit:r,specification:a,activityExplain:n,id:c,validDate:u,productDate:m}),i.commoditysInfoUrl=t.CheckcommoditysInfoUrl(i.commoditysInfoUrl),i.listImageUrl=t.CheckcommoditysInfoUrl(i.listImageUrl),i=l()({},i,{useState:0,putawayState:2,type:t.mode,commoditySpecificationVo:d}),_.a.applyByCommodity(i).then(function(e){t.$message.success("重新提交审核成功"),t.$router.back()})}}).catch(function(e){e||t.$message.error("请检查表单是否填写完整")})},addcommodity:function(){var t=this;this.$refs.form.validate().then(function(e){if(e){var i=t.form,o=i.commoditySpecificationVo,r=o.unit,a=o.specification,s=o.approvalNumber,n=o.activityExplain,c=o.id,u=o.validDate,m=o.productDate,d=new Object;1===t.mode?d={unit:r,specification:a,approvalNumber:s,activityExplain:n,id:c,validDate:u,productDate:m}:2===t.mode&&(d={unit:r,specification:a,activityExplain:n,id:c,validDate:u,productDate:m}),i.commoditysInfoUrl=t.CheckcommoditysInfoUrl(i.commoditysInfoUrl),i.listImageUrl=t.CheckcommoditysInfoUrl(i.listImageUrl),i=l()({},i,{type:t.mode,commoditySpecificationVo:d}),_.a.addcommodity(i).then(function(e){t.$message.success("保存成功"),t.$router.back()})}}).catch(function(e,i){e||t.$message.error("请检查表单是否填写完整")})},editcommodity:function(){var t=this;this.$refs.form.validate().then(function(e){if(e){var i=t.form,o=i.commoditySpecificationVo,r=o.unit,a=o.specification,s=o.approvalNumber,n=o.activityExplain,c=o.id,u=o.validDate,m=o.productDate,d=new Object;1===t.mode?d={unit:r,specification:a,approvalNumber:s,activityExplain:n,id:c,validDate:u,productDate:m}:2===t.mode&&(d={unit:r,specification:a,activityExplain:n,id:c,validDate:u,productDate:m}),i.commoditysInfoUrl=t.CheckcommoditysInfoUrl(i.commoditysInfoUrl),i.listImageUrl=t.CheckcommoditysInfoUrl(i.listImageUrl),i=l()({},i,{type:t.mode,commoditySpecificationVo:d}),_.a.editcommodity(i).then(function(e){t.$message.success("保存成功"),t.$router.back()})}}).catch(function(e){e||t.$message.error("请检查表单是否填写完整")})},CheckcommoditysInfoUrl:function(t){var e=[];if(t.length>0){var i=0,o=!0,a=!1,l=void 0;try{for(var s,n=r()(t);!(o=(s=n.next()).done);o=!0){var c=s.value,u=c.seq,m=c.url;e.push({seq:u,url:m}),0!=u&&null!==u&&""!==u||i++}}catch(t){a=!0,l=t}finally{try{!o&&n.return&&n.return()}finally{if(a)throw l}}i===t.length&&(e[0].seq=1)}return e},resetForm:function(){var t;this.editMode?(this.$refs.form.resetFields(),this.getProductDetail(this.id)):(this.$refs.form.resetFields(),this.form=(t={id:"",categoryId:"",minNumber:"",individualPurchasePrice:"",putawayTime:"",originalPrice:"",grouponPrice:"",drugs:[{}],businessArea:"",supply:"",soldOutTime:""},u()(t,"minNumber",""),u()(t,"shopMul",""),u()(t,"seq",""),u()(t,"repertory",""),u()(t,"commoditySpecificationVo",{commodityId:"",specification:"",unit:"",packNumber:"",entiretyNumber:"",approvalNumber:"",manufacturers:""}),u()(t,"drugTestUrl",{}),u()(t,"listImageUrl",[]),u()(t,"commoditysInfoUrl",[]),t))},handlelistImageSuccess:function(t,e){200==t.code&&(void 0===this.form.listImageUrl&&(this.form.listImageUrl=[]),this.form.listImageUrl.push({url:t.data.url}))},handlecommoditysInfoImageSuccess:function(t,e){200==t.code&&(void 0===this.form.commoditysInfoUrl&&(this.form.commoditysInfoUrl=[]),this.form.commoditysInfoUrl.push({url:t.data.url}))},checkList:function(t,e,i){0==e.length?i(new Error("请上传商品列表图片")):i()},handleSuccess:function(t,e){var i=this.form.commoditysInfoUrl;200==t.code&&(i.push({url:t.data.url}),this.form.commoditysInfoUrl=i)},handleRemove:function(t,e){var i;i=e.map(function(t){return{url:t.url}}),this.form.commoditysInfoUrl=i},handlelistImageRemove:function(t,e){var i;i=e.map(function(t){return{url:t.url}}),this.form.listImageUrl=i},beforeUpload:function(t){var e=["image/jpeg","image/png"].indexOf(t.type)>-1;return e||this.$message.error("上传的图片只能是 JPG 或 PNG 格式!"),e}},watch:{mode:function(t,e){this.editMode||(this.form.drugs=[{}])}},components:{AddProductOne:g,AddProductPackage:A,oneupload:b.a}},S={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"AddProduct"},[i("AutoBreadcrumb"),t._v(" "),i("div",{staticClass:"content-box"},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"140px",disabled:1==t.open}},[i("h3",{attrs:{id:"base"}},[t._v("商品基础信息")]),t._v(" "),i("el-form-item",{attrs:{label:"销售类型"}},[i("el-radio-group",{attrs:{disabled:t.editMode},model:{value:t.mode,callback:function(e){t.mode=e},expression:"mode"}},[i("el-radio",{attrs:{label:1}},[t._v("单品销售")]),t._v(" "),i("el-radio",{attrs:{label:2}},[t._v("套餐销售")])],1)],1),t._v(" "),1==t.mode?i("AddProductOne",{attrs:{form:t.form},on:{"update:form":function(e){t.form=e}}}):t._e(),t._v(" "),2==t.mode?i("AddProductPackage",{attrs:{form:t.form},on:{"update:form":function(e){t.form=e}}}):t._e(),t._v(" "),i("h3",{attrs:{id:"price"}},[t._v("价格/库存")]),t._v(" "),i("el-form-item",{attrs:{label:"原价",prop:"originalPrice",rules:[{required:!0,message:"请输入原价",trigger:"blur"},{validator:t.validator.price,trigger:"blur"}]}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.originalPrice,callback:function(e){t.$set(t.form,"originalPrice",e)},expression:"form.originalPrice"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"单体采购价",prop:"individualPurchasePrice",rules:[{required:!0,message:"请输入单体采购价",trigger:"blur"},{validator:t.validator.price,trigger:"blur"}]}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.individualPurchasePrice,callback:function(e){t.$set(t.form,"individualPurchasePrice",e)},expression:"form.individualPurchasePrice"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"连锁采购价",prop:"grouponPrice",rules:{validator:t.validator.price,trigger:"blur"}}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.grouponPrice,callback:function(e){t.$set(t.form,"grouponPrice",e)},expression:"form.grouponPrice"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"添加库存",prop:"repertory",rules:[{required:!0,message:"请输入库存",trigger:"blur"},{validator:t.validator.positiveIntegers,trigger:"blur"}]}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.repertory,callback:function(e){t.$set(t.form,"repertory",t._n(e))},expression:"form.repertory"}})],1)],1),t._v(" "),i("h3",{attrs:{id:"supply"}},[t._v("供货信息")]),t._v(" "),i("el-form-item",{attrs:{label:"业务商圈"}},[i("el-col",{attrs:{lg:12}},[i("el-radio-group",{model:{value:t.form.businessArea,callback:function(e){t.$set(t.form,"businessArea",e)},expression:"form.businessArea"}},[i("el-radio",{attrs:{label:"0"}},[t._v("全国通用")]),t._v(" "),t._l(t.businessAreaList,function(e,o){return i("el-radio",{key:"businessAreaitem_"+o,attrs:{label:e.tradingId}},[t._v(t._s(e.tradingAreaName))])})],2)],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"供货对象"}},[i("el-col",{attrs:{lg:12}},[i("el-radio-group",{model:{value:t.form.supply,callback:function(e){t.$set(t.form,"supply",e)},expression:"form.supply"}},[i("el-radio",{attrs:{label:"零售单体+第三终端"}}),t._v(" "),i("el-radio",{attrs:{label:"零售单体+第三终端+连锁总部"}}),t._v(" "),i("el-radio",{attrs:{label:"零售单体"}})],1)],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"上架时间",prop:"putawayTime",rules:[{required:!0,message:"请选择上架时间",trigger:"blur"}]}},[i("el-col",{attrs:{lg:6}},[i("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"选择日期时间"},model:{value:t.form.putawayTime,callback:function(e){t.$set(t.form,"putawayTime",t._n(e))},expression:"form.putawayTime"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"下架时间"}},[i("el-col",{attrs:{lg:6}},[i("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"选择日期时间"},model:{value:t.form.soldOutTime,callback:function(e){t.$set(t.form,"soldOutTime",t._n(e))},expression:"form.soldOutTime"}})],1)],1),t._v(" "),i("h3",{attrs:{id:"data"}},[t._v("商品信息")]),t._v(" "),i("el-form-item",{attrs:{label:"商品活动说明"}},[i("el-col",{attrs:{lg:6}},[i("el-input",{attrs:{type:"textarea",rows:3},model:{value:t.form.commoditySpecificationVo.activityExplain,callback:function(e){t.$set(t.form.commoditySpecificationVo,"activityExplain",e)},expression:"form.commoditySpecificationVo.activityExplain"}})],1),t._v(" "),i("el-col",{attrs:{lg:6,offset:1}},[i("span",{staticClass:"remark"},[t._v("(如果需要对产品具体描述，或有特殊需要时可填写)")])])],1),t._v(" "),i("el-form-item",{attrs:{label:"有效期至"}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.commoditySpecificationVo.validDate,callback:function(e){t.$set(t.form.commoditySpecificationVo,"validDate",e)},expression:"form.commoditySpecificationVo.validDate"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"生产日期"}},[i("el-col",{attrs:{lg:6}},[i("el-input",{model:{value:t.form.commoditySpecificationVo.productDate,callback:function(e){t.$set(t.form.commoditySpecificationVo,"productDate",e)},expression:"form.commoditySpecificationVo.productDate"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"批号"}},[i("el-col",{attrs:{lg:6}},[i("el-input",{attrs:{disabled:""},model:{value:t.form.drugs[0].approvalNumber,callback:function(e){t.$set(t.form.drugs[0],"approvalNumber",e)},expression:"form.drugs[0].approvalNumber"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"药检报告"}},[i("el-col",{attrs:{lg:6}},[i("oneupload",{attrs:{rules:["image/jpeg","image/png"]},model:{value:t.form.drugTestUrl.url,callback:function(e){t.$set(t.form.drugTestUrl,"url",e)},expression:"form.drugTestUrl.url"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"列表图片",prop:"listImageUrl",rules:[{required:!0,message:"请上传列表图片",trigger:"blur"},{validator:t.checkList,trigger:"blur"}]}},[i("el-col",{attrs:{lg:18}},[i("el-upload",{ref:"uploader_1",staticClass:"images-uploader picture-card",attrs:{"before-upload":t.beforeUpload,action:t.UploadUrl,headers:t.Headers,"file-list":t.form.listImageUrl,"list-type":"picture-card","on-success":t.handlelistImageSuccess,"on-remove":t.handlelistImageRemove}},[i("i",{staticClass:"el-icon-plus images-uploader-icon"})])],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"商品详情页图片(可上传10张)"}},[i("el-col",{attrs:{lg:18}},[i("el-upload",{attrs:{action:t.UploadUrl,headers:t.Headers,limit:10,"list-type":"picture-card","file-list":t.form.commoditysInfoUrl,"before-upload":t.beforeUpload,"on-success":t.handleSuccess,"on-remove":t.handleRemove}},[i("i",{staticClass:"el-icon-plus images-uploader-icon"})])],1)],1)],1),t._v(" "),i("div",{staticClass:"btn-submit"},[1!=t.open&&2!=t.open?i("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")]):t._e(),t._v(" "),1==t.open?i("el-button",{attrs:{type:"primary"},on:{click:t.commoditysByOpen}},[t._v("立即上架")]):t._e(),t._v(" "),2==t.open?i("el-button",{attrs:{type:"primary"},on:{click:t.applyByCommodity}},[t._v("重新提交上架申请")]):t._e(),t._v(" "),t.editMode&&t.open?t._e():i("el-button",{attrs:{type:"info"},on:{click:t.resetForm}},[t._v("重置")])],1)],1),t._v(" "),t._m(0)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"point"},[e("div",{staticClass:"point-item"},[e("a",{attrs:{href:"#base"}},[this._v("商品基础信息")])]),this._v(" "),e("div",{staticClass:"point-item"},[e("a",{attrs:{href:"#price"}},[this._v("价格/库存")])]),this._v(" "),e("div",{staticClass:"point-item"},[e("a",{attrs:{href:"#supply"}},[this._v("供货信息")])]),this._v(" "),e("div",{staticClass:"point-item"},[e("a",{attrs:{href:"#data"}},[this._v("商品信息")])])])}]};var x=i("vSla")(C,S,!1,function(t){i("cy5p")},null,null);e.default=x.exports}});